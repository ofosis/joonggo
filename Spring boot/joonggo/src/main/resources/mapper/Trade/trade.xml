<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kb.joonggo.Tradeboard.TradeboardRepository">

    <select id="BuyAlllist" resultType="TradeboardDTO">
        select * from Tradeboard where tb_state = "구매중"
    </select>

    <select id="Buylist" resultType="TradeboardDTO" parameterType="Integer">
        SELECT * FROM Tradeboard
        where tb_state = "구매중"
        ORDER BY tb_idx desc
        LIMIT #{pageNum}, 3;
    </select>

    <select id="selectBuyRow" parameterType="Integer" resultType="TradeboardDTO">
        SELECT * FROM Tradeboard JOIN Member ON Tradeboard.mbr_idx = Member.mbr_idx WHERE tb_idx = #{tb_idx}
    </select>

    <select id="countBuyRow" resultType="Integer">
        select count(*) from Tradeboard where tb_state = "구매중"
    </select>

    <select id="selectRow2" resultType="TradeboardReq" parameterType="Integer">
        select * from Tradeboard join Member on Member.mbr_idx = Tradeboard.mbr_idx where tb_idx = #{tb_idx}
    </select>


    <select id="SellAlllist" resultType="TradeboardDTO">
        select * from Tradeboard where tb_state = "판매중"
    </select>

    <select id="Selllist" resultType="TradeboardDTO" parameterType="Integer">
        SELECT * FROM Tradeboard
        where tb_state = "판매중"
        ORDER BY tb_idx desc
        LIMIT #{pageNum}, 3;
    </select>

    <select id="selectSellRow" parameterType="Integer" resultType="TradeboardDTO">
        select * from Tradeboard where tb_idx = #{tb_idx}
    </select>

    <select id="countSellRow" resultType="Integer">
        select count(*) from Tradeboard where tb_state = "판매중"
    </select>

    <insert id="insertImage">
        INSERT INTO Image
        (img_name, img_url, img_blob)
        VALUES
        (#{img_name}, #{img_url}, #{img_blob});
    </insert>

    <insert id="insert" parameterType="TradeboardDTO">
        insert into Tradeboard
        (tb_title, tb_content, tb_date, tb_price, tb_category, tb_count, tb_state)
        values
        (#{tb_title}, #{tb_content}, #{tb_date}, #{tb_price}, #{tb_category}, #{tb_count}, #{tb_state})
    </insert>

    <select id="search_tb_idx" parameterType="map" resultType="Integer">
        select tb_idx from Tradeboard
        where tb_title = #{tb_title}
        AND tb_content = #{tb_content}
        AND tb_price = #{tb_price}
        AND tb_category = #{tb_category}
        AND tb_count = #{tb_count}
        AND tb_state = #{tb_state}
    </select>

    <update id="img_idx_update" parameterType="map">
        update Tradeboard
        set img_idx = #{img_idx}
        where tb_idx = #{tb_idx}
        AND tb_title = #{tb_title}
        AND tb_content = #{tb_content}
        AND tb_price = #{tb_price}
        AND tb_category = #{tb_category}
        AND tb_count = #{tb_count}
        AND tb_state = #{tb_state}
    </update>


</mapper>