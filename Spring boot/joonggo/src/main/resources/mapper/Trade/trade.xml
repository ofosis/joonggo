<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kb.joonggo.Tradeboard.TradeboardRepository">

    <select id="BuyAlllist" resultType="TradeboardDTO">
        select * from Tradeboard where tb_state = "구매중"
    </select>

    <select id="Buylist" resultType="TradeboardDTO" parameterType="Integer">
        SELECT * FROM Tradeboard
        where tb_state = "구매중"
        ORDER BY tb_idx desc
        LIMIT #{pageNum}, 3;
    </select>


    <select id="selectBuyRow" parameterType="Integer" resultType="TradeboardDTO">
        SELECT * FROM Tradeboard JOIN Member ON Tradeboard.mbr_idx = Member.mbr_idx WHERE tb_idx = #{tb_idx}
    </select>

    <select id="countBuyRow" resultType="Integer">
        select count(*) from Tradeboard where tb_state = "구매중"
    </select>

<!--    <select id="countBuyRow" resultType="Integer">-->
<!--    select count(*)-->
<!--    FROM Tradeboard-->
<!--    JOIN Image ON Tradeboard.tb_idx = Image.tb_idx-->
<!--    where tb_state = "구매중"-->
<!--    </select>-->

    <select id="selectRow2" resultType="TradeboardReq" parameterType="Integer">
        select * from Tradeboard join Member on Member.mbr_idx = Tradeboard.mbr_idx where tb_idx = #{tb_idx}
    </select>


    <select id="SellAlllist" resultType="TradeboardDTO">
        select * from Tradeboard where tb_state = "판매중"
    </select>

    <select id="Selllist" resultType="TradeboardDTO" parameterType="Integer">
        SELECT * FROM Tradeboard
        where tb_state = "판매중"
        ORDER BY tb_idx desc
        LIMIT #{pageNum}, 3;
    </select>

<!--    <select id="Selllist" resultType="TradeboardReq" parameterType="Integer">-->
<!--        SELECT t.*, i.img_name, i.img_path-->
<!--        FROM Tradeboard t-->
<!--        JOIN Image i ON t.img_idx = i.img_idx-->
<!--        where tb_state = "판매중"-->
<!--        ORDER BY tb_idx desc-->
<!--        LIMIT #{pageNum}, 3;-->
<!--    </select>-->

    <select id="Recoselllist" resultType="TradeboardReq" parameterType="map">
        SELECT * FROM Tradeboard t
        JOIN Member m ON t.mbr_idx = m.mbr_idx
        WHERE tb_category = #{category} AND m.mbr_idx != 123
        ORDER BY tb_count DESC;
    </select>

    <select id="selectSellRow" parameterType="Integer" resultType="TradeboardDTO">
        select * from Tradeboard where tb_idx = #{tb_idx}
    </select>

    <select id="countSellRow" resultType="Integer">
        select count(*) from Tradeboard where tb_state = "판매중"
    </select>

<!--    <select id="countSellRow" resultType="Integer">-->
<!--    select count(*)-->
<!--    FROM Tradeboard-->
<!--    JOIN Image ON Tradeboard.tb_idx = Image.tb_idx-->
<!--    where tb_state = "판매중"-->
<!--    </select>-->

    <insert id="insert" parameterType="TradeboardDTO">
        insert into Tradeboard
        (tb_title, tb_content, tb_date, tb_price, tb_category, tb_count, tb_state, mbr_idx, img_idx)
        values
        (#{tb_title}, #{tb_content}, #{tb_date}, #{tb_price}, #{tb_category}, #{tb_count}, #{tb_state}, #{mbr_idx}, #{img_idx})
    </insert>

</mapper>